@using Abp.Configuration.Startup
@using Abp.Web.Mvc.Alerts
@using Abp.Web.Security.AntiForgery
@using ShareData.Web.Resources
@inject IAbpAntiForgeryManager AbpAntiForgeryManager
@inject IMultiTenancyConfig MultiTenancyConfig
@inject IWebResourceManager WebResourceManager
@inject IAlertManager AlertManager
@inject ILanguageManager LanguageManager
@{
    AbpAntiForgeryManager.SetCookie(Context);
    var pageTitle = L("Form.DataForm");
    var dataSharingPeriodicities = ViewData["DataSharingPeriodicities"] as SelectList;
    Layout = null;
}

<!DOCTYPE html>
<html class="loading" lang="@LanguageManager.CurrentLanguage.Name">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="Apex admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Apex admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>@pageTitle</title>
    <link rel="shortcut icon" type="image/x-icon" href="~/img/ico/logo.png">
    <link rel="shortcut icon" type="image/png" href="~/img/ico/logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" type="text/css" href="~/fonts/feather/style.min.css">
    <link rel="stylesheet" type="text/css" href="~/fonts/simple-line-icons/style.min.css">
    <link rel="stylesheet" type="text/css" href="~/fonts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="~/vendors/css/perfect-scrollbar.min.css">
    <link rel="stylesheet" type="text/css" href="~/vendors/css/toastr.css">
    <link rel="stylesheet" type="text/css" href="~/vendors/css/prism.min.css">
    <link rel="stylesheet" type="text/css" href="~/vendors/css/switchery.min.css">
    <link rel="stylesheet" type="text/css" href="~/vendors/css/pickadate/pickadate.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/bootstrap-extended.min.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/colors.min.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/components.min.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/themes/layout-dark.min.css">
    <link rel="stylesheet" href="~/css-rtl/plugins/switchery.min.css">
    <link rel="stylesheet" type="text/css" href="~/css-rtl/custom-rtl.min.css">
    <link rel="stylesheet" type="text/css" href="~/css/style-rtl.css">

    <style>
        .vertical-menu .navbar {
            background-color: #2EA54F;
        }

        .vertical-layout.navbar-sticky nav.header-navbar {
            width: 100%;
        }

        .vertical-menu .navbar {
            margin-right: 0px;
        }

        .gradient-mint {
            background-image: -webkit-linear-gradient(135deg,#239d60,#6CD975);
            background-image: linear-gradient(-45deg,#1c6d30,#6CD975);
            background-repeat: repeat-x;
        }
    </style>
</head>
<body class="vertical-layout vertical-menu 2-columns  navbar-sticky" data-menu="vertical-menu" data-col="2-columns">
    <nav class="navbar navbar-expand-lg navbar-light header-navbar navbar-fixed">
        <div class="container-fluid navbar-wrapper">
            <div class="navbar-header d-flex">
                <div class="navbar-toggle menu-toggle d-xl-none d-block float-left align-items-center justify-content-center" data-toggle="collapse"><i class="ft-menu font-medium-3"></i></div>
                <ul class="navbar-nav">
                    <li class="nav-item mr-2 d-none d-lg-block"><a class="nav-link apptogglefullscreen" id="navbar-fullscreen" href="javascript:;"><i class="ft-maximize font-medium-3"></i></a></li>
                </ul>
            </div>
            <div class="navbar-container">
                <div class="collapse navbar-collapse d-block" id="navbarSupportedContent">
                    <a type="button" class="btn btn-social btn-twitter gradient-mint" asp-controller="Account" asp-action="Login">
                        @L("LogIn")
                        <i class="fa fa-sign-in"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <div class="wrapper">
        <div class="main-panel">
            <div class="content-wrapper">
                <section id="action-form-layout">
                    <div class="row match-height">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">@L("Form.SharingRequestForm")</h4>
                                </div>
                                <div class="card-content">
                                    <div class="card-body">
                                        <p>@L("Form.DataRequesterInformation")</p>
                                        <form name="dataForm" role="form" class="form-horizontal">
                                            <div class="form-group">
                                                <label for="name">@L("Form.EntityName")</label>
                                                <input type="text" id="name" class="form-control" name="EntityName" required>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-md-4 col-12">
                                                    <div class="form-group position-relative">
                                                        <label for="representativeName">@L("Form.EntityRepresentativeName")</label>
                                                        <input type="text" id="representativeName" class="form-control" name="EntityRepresentativeName" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-12">
                                                    <div class="form-group position-relative">
                                                        <label for="phoneNumber">@L("PhoneNumber")</label>
                                                        <input type="text" id="phoneNumber" class="form-control" name="PhoneNumber" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-12">
                                                    <div class="form-group position-relative">
                                                        <label for="emailAddress">@L("EmailAddress")</label>
                                                        <input type="text" id="emailAddress" class="form-control" name="EmailAddress" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="dataSetName">@L("Form.DataSetName")</label>
                                                <input type="text" id="dataSetName" class="form-control" name="DataSetName" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="requiredData">@L("Form.RequiredData")</label>
                                                <textarea id="requiredData" class="form-control" name="RequiredData"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="participationPurpose">@L("Form.ParticipationPurpose")</label>
                                                <textarea id="participationPurpose" class="form-control" name="ParticipationPurpose"></textarea>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group position-relative">
                                                        <label for="useDate">@L("Form.UseDate")</label>
                                                        <input type="text" id="useDate" class="form-control pickadate" placeholder="@L("PickDate")" name="UseDate" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-12">
                                                    <div class="form-group position-relative">
                                                        <label for="usePeriod">@L("Form.UsePeriod")</label>
                                                        <input type="number" id="usePeriod" class="form-control" name="UsePeriod" maxlength="6" step="1" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="dataSharingPeriodicity">@L("Form.DataSharingPeriodicity")</label>
                                                @foreach (var type in dataSharingPeriodicities)
                                                {
                                                    <div class="col-md-6">
                                                        <input type="checkbox" name="DataSharingPeriodicity" id="@type.Value" value="@type.Value" />
                                                        <label for="@type.Value" title="@type.Text">@type.Text</label>
                                                    </div>
                                                }
                                            </div>
                                            <div style="text-align: center;">
                                                <button type="button" class="btn btn-success mr-2" onclick="create()"><i class="ft-check-square mr-1"></i>@L("Save")</button>
                                                <button type="button" class="btn btn-secondary" onclick="resetForm()"><i class="ft-x mr-1"></i>@L("Cancel")</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- BEGIN : Footer-->
            <footer class="footer undefined undefined">
                <p class="clearfix text-muted m-0"><span> &copy; @DateTime.Now.Year &nbsp;</span>@*<a href="https://themeforest.net/user/pixinvent/portfolio?ref=pixinvent" id="pixinventLink" target="_blank">PIXINVENT</a>*@<span class="d-none d-sm-inline-block">- المركز الوطني للرقابة على الالتزام البيئي</span></p>
            </footer>
            <!-- End : Footer-->
            <!-- Scroll to top button -->
            <button class="btn btn-success scroll-top" type="button"><i class="ft-arrow-up"></i></button>

        </div>
    </div>

    <script src="~/vendors/js/vendors.min.js"></script>
    <script src="~/vendors/js/switchery.min.js"></script>
    <script src="~/vendors/js/pickadate/picker.js"></script>
    <script src="~/vendors/js/pickadate/picker.date.js"></script>
    <script src="~/vendors/js/pickadate/picker.time.js"></script>
    <script src="~/vendors/js/pickadate/legacy.js"></script>
    <script src="~/vendors/js/toastr.min.js"></script>
    <script src="~/libs/abp-web-resources/Abp/Framework/scripts/abp.js" asp-append-version="true"></script>
    <script src="~/libs/abp-web-resources/Abp/Framework/scripts/libs/abp.jquery.js" asp-append-version="true"></script>
    <script src="~/js/core/app-menu.min.js"></script>
    <script src="~/js/core/app.min.js"></script>
    <script src="~/js/notification-sidebar.min.js"></script>
    <script src="~/js/customizer.min.js"></script>
    <script src="~/js/scroll-top.min.js"></script>
    <script src="~/js/datetime-picker.min.js"></script>
    <script src="~/js/scripts.js"></script>
</body>
</html>
<script>
    function create() {
        var _$form = $('form[name="dataForm"]');
        abp.ui.setBusy(_$form);
        // Serialize the form data as an object
        var formData = _$form.serializeArray().reduce(function (obj, item) {
            obj[item.name] = item.value;
            return obj;
        }, {});

        // Format UseDate
        if (formData.useDate) {
            formData.useDate = new Date(formData.useDate).toISOString();
        }

        $.ajax({
            type: "POST",
            url: "@Url.Action("Create","DataForm")",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (res) {
                abp.ui.clearBusy(_$form);
                toastr.success(res.result, '@L("Success")');
                resetForm();
            },
            error: function (res) {
                toastr.error(res.responseJSON.error.message, '@L("Error")');
            }
        });
    }
    function resetForm() {
        // Reset the form to its initial state
        $('form[name="dataForm"]').trigger('reset');
    }
</script>